@inherits LayoutComponentBase
@inject AuthenticationState authState
@inject IUriHelper uriHelper

@if (IsLoggedIn)
{
    <MatAppBarContainer>
        <MatAppBar Fixed="true">
            <MatAppBarRow>
                <MatAppBarSection>
                    <MatAppBarTitle>
                        <img alt="Blazor Boilerplate" class="logo-img" src="images/blazorboilerplate-dark.svg" title="Blazor Boilerplate">
                        <a class="brand" href="/">Blazor Boilerplate</a>
                    </MatAppBarTitle>
                    <MatTooltip Tooltip="Toggle Navigation">
                        <MatIconButton Icon="radio_button_checked" ToggleIcon="radio_button_unchecked" OnClick="@((e) => NavToggle())" RefBack="@context"></MatIconButton>
                    </MatTooltip>
                </MatAppBarSection>
                <MatAppBarSection Align="@MatAppBarSectionAlign.End">
                    <MatTooltip Tooltip="Donate to Support">
                        <MatIconButton Link="https://www.paypal.me/enkodellc" RefBack="@context"><i class="fa fa-cc-paypal"></i></MatIconButton>
                    </MatTooltip>
                    <MatTooltip Tooltip="Github Repository">
                        <MatIconButton Link="https://github.com/enkodellc/blazorboilerplate" RefBack="@context"><i class="fa fa-github" aria-hidden="true"></i></MatIconButton>
                    </MatTooltip>
                    <MatTooltip Tooltip="Logout">
                        <MatIconButton Icon="exit_to_app" RefBack="@context" onclick="@LogoutClick"></MatIconButton>
                    </MatTooltip>
                </MatAppBarSection>
            </MatAppBarRow>
        </MatAppBar>

        <MatAppBarContent>
            <MatDrawerContainer Style="width: 100vw; height: 100vh;" Class="mdc-theme--surface">
                <MatDrawer bind-Opened="@_navMenuOpened">
                    <header class="drawer-header">
                       <MatIcon Icon="account_circle"></MatIcon> 
                       <h3>@userInfo.Username</h3>
                    </header>
                    <NavMenu />
                    <footer class="drawer-footer">
                        <MatButton Icon="help" Link="https://github.com/enkodellc/blazorboilerplate">Help & Support</MatButton>
                        <br />
                        © 2019 <a href="//blazorboilerplate.com">Blazor Boilerplate</a><br/>
                        Version 0.1.0
                    </footer>
                </MatDrawer>
                <MatDrawerContent>
                    @*<div class="breadcrumb">
                            <ul>
                                <li>
                                    <a href="/">Home</a>
                                </li>
                            </ul>
                        </div>*@
                    <section class="container-fluid">
                        @Body
                    </section>
                </MatDrawerContent>
            </MatDrawerContainer>
        </MatAppBarContent>
    </MatAppBarContainer>
}


@functions{
    protected bool IsLoggedIn;
    bool _navMenuOpened = true;
    UserInfo userInfo = null;

    protected override async Task OnInitAsync()
    {
        IsLoggedIn = await authState.IsLoggedIn();
        if (!IsLoggedIn)
        {
            uriHelper.NavigateTo("/login");
        }
        else
        {
            userInfo = await authState.GetUserInfo();
        }
    }

    async Task LogoutClick()
    {
        await authState.Logout();
        uriHelper.NavigateTo("/login");
    }

    void NavToggle()
    {
        _navMenuOpened = !_navMenuOpened;
        this.StateHasChanged();
    }

}
